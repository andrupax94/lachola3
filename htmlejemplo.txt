

//CARGAR IMAGENES
//
function custom_image_url_endpoint() {
    // Registra el endpoint para obtener la URL de la imagen por ID
    register_rest_route('custom/v1', '/image/(?P<id>\d+)', array(
        'methods' => 'GET',
        'callback' => 'get_image_by_id',
    ));
}

add_action('rest_api_init', 'custom_image_url_endpoint');

function get_image_by_id($data) {
    $attachment_id = $data['id'];
    $image_url = wp_get_attachment_url($attachment_id);

    if ($image_url) {
        // Obtiene el tipo de contenido de la imagen
        $filetype = wp_check_filetype($image_url, null);

        // Configura las cabeceras para la respuesta
        header("Content-Type: {$filetype['type']}");
        header('Content-Disposition: inline; filename="' . basename($image_url) . '"');

        // Lee y envÃ­a la imagen al navegador
        readfile($image_url);
        exit;
    } else {
        // Maneja el caso en el que la imagen no se encuentre
        return new WP_Error('image_not_found', 'Imagen no encontrada', array('status' => 404));
    }
}


//FILTRO MILAGROSO
// This enables the orderby=menu_order for Posts
add_filter( 'rest_post_collection_params', 'filter_add_rest_orderby_params', 10, 1 );
// And this for a custom post type called 'portfolio'
add_filter( 'rest_evento_collection_params', 'filter_add_rest_orderby_params', 10, 1 );
function maximum_api_filter($query_params) {
    $query_params['per_page']["maximum"]=1000;
    return $query_params;
}
add_filter('rest_evento_collection_params', 'maximum_api_filter');
/**
 * Add menu_order to the list of permitted orderby values
 */
function filter_add_rest_orderby_params( $params ) {
	 $custom_fields = array(
       "acm_fields.banner",
"acm_fields.imagen",
"acm_fields.nombre",
"acm_fields.descripcion",
"acm_fields.tasa",
"acm_fields.categoria",
"acm_fields.tipoMetraje",
"acm_fields.tipoFestival",
"acm_fields.fechaInicio",
"acm_fields.fechaLimite",
"acm_fields.fuente",
"acm_fields.url",
"acm_fields.telefono",
"acm_fields.correoElectronico",
"acm_fields.web",
"acm_fields.facebook",
"acm_fields.ubicacion",
"acm_fields.instagram",
"acm_fields.youtube",
"acm_fields.industrias",
"acm_fields.twitterX"
        // Agrega tantos campos personalizados como desees permitir
    );

    $params['orderby']['enum'] = array_merge( $params['orderby']['enum'], $custom_fields );
	return $params;
}

